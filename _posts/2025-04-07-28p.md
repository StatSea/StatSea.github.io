---
layout: single
title: "[CD] ìœ„í‚¤í”¼ë””ì•„ í¬ë¡¤ë§3"
categories: [CD]
tags: [CD, Crawling , Project]
---
í¬ë¡¤ë§ ì½”ë“œë¥¼ ê°œì„ í•˜ì—¬ í¬ë¡¤ë§ì„ ë‹¤ì‹œ í•´ë³´ì•˜ë‹¤.
---

## ì½”ë“œ
```R

# ğŸ“¦ í•„ìš”í•œ íŒ¨í‚¤ì§€ ë¡œë“œ
library(rvest)
library(dplyr)
library(stringr)
library(purrr)

# âœ… 1. êµ­ì™• ëª©ë¡ í˜ì´ì§€ í¬ë¡¤ë§
main_url <- "https://ko.wikipedia.org/wiki/ì¡°ì„ _êµ­ì™•"
page <- read_html(main_url)

# âœ… 2. êµ­ì™• ì´ë¦„ + URL ì¶”ì¶œ
king_nodes <- page %>%
  html_nodes("table.wikitable tbody tr td:nth-child(2) a")

king_df <- tibble(
  king = king_nodes %>% html_text(trim = TRUE),
  url = king_nodes %>% html_attr("href") %>% paste0("https://ko.wikipedia.org", .)
) %>%
  filter(king != "")  # ë¹ˆ ê°’ ì œê±°

# âœ… 3. ë“œë¼ë§ˆ ì •ë³´ ì¶”ì¶œ í•¨ìˆ˜
extract_dramas <- function(url, king_name) {
  page <- tryCatch(read_html(url), error = function(e) return(NULL))
  if (is.null(page)) return(NULL)
  
  drama_divs <- page %>%
    html_nodes(xpath = "//div[h3[contains(text(), 'ë“œë¼ë§ˆ')]]")
  
  if (length(drama_divs) == 0) return(NULL)
  
  result <- list()
  
  for (div in drama_divs) {
    # ğŸ“¦ í…Œì´ë¸” ì¶”ì¶œ
    table_node <- div %>%
      html_nodes(xpath = "following-sibling::*[self::table[contains(@class, 'wikitable')]][1]")
    
    if (length(table_node) > 0) {
      table_df <- tryCatch(html_table(table_node, fill = TRUE)[[1]], error = function(e) NULL)
      if (!is.null(table_df)) {
        drama_texts <- apply(table_df, 1, function(row) paste(row, collapse = " | "))
        table_df <- data.frame(
          king = king_name,
          drama_info = drama_texts,
          stringsAsFactors = FALSE
        )
        result <- append(result, list(table_df))
      }
    }
    
    # ğŸ“¦ ë¦¬ìŠ¤íŠ¸ ì¶”ì¶œ
    ul_node <- div %>%
      html_nodes(xpath = "following-sibling::*[self::ul][1]")
    
    if (length(ul_node) > 0) {
      items <- ul_node %>%
        html_nodes("li") %>%
        html_text(trim = TRUE)
      if (length(items) > 0) {
        ul_df <- data.frame(
          king = king_name,
          drama_info = items,
          stringsAsFactors = FALSE
        )
        result <- append(result, list(ul_df))
      }
    }
  }
  
  if (length(result) > 0) return(bind_rows(result)) else return(NULL)
}

# âœ… 4. ëª¨ë“  ì™• í˜ì´ì§€ì—ì„œ ë“œë¼ë§ˆ ì •ë³´ ìˆ˜ì§‘
all_dramas <- map2_dfr(king_df$url, king_df$king, extract_dramas)

# âœ… 5. ë¹„ì •ìƒ í…ìŠ¤íŠ¸ í•„í„°ë§
all_dramas_clean <- all_dramas %>%
  filter(
    nchar(drama_info) >= 10,
    str_detect(
      drama_info,
      "ë“œë¼ë§ˆ|ë°°ìš°|ë°©ì†¡|ë°©ì˜|ì¶œì—°|ì—­í• |ì˜í™”|KBS|KBS1|KBS2|MBC|SBS|JTBC|tvN|TBC|MBN|TVì¡°ì„ |ì±„ë„A|ENA|TBC"
    )
  )

# âœ… 6. NA í…ìŠ¤íŠ¸ í›„ì²˜ë¦¬ (ì¤„ ëì˜ "| NA" ë˜ëŠ” ë¶ˆí•„ìš”í•œ ê³µë°± ì œê±°)
all_dramas_clean$drama_info <- all_dramas_clean$drama_info %>%
  str_replace("\\|\\s*NA$", "") %>%       # "| NA" ì œê±°
  str_replace("\\|\\s*$", "")             # ë§¨ ë "|" ì œê±°

# âœ… 7. í™•ì¸ ë° ì €ì¥
print(head(all_dramas_clean, 10))
write.csv(all_dramas_clean, "ì¡°ì„ ì™•ì¡°_ë“œë¼ë§ˆì •ë³´_NAìµœì¢…ì •ì œ.csv", row.names = FALSE, fileEncoding = "UTF-8")

# â–¶ï¸ ê²°ê³¼ ë°˜í™˜
all_dramas_clean

```

## ê²°ê³¼

![image](https://github.com/user-attachments/assets/d82e5bc4-1556-4d2b-8c22-2160dbc1f1e2)


